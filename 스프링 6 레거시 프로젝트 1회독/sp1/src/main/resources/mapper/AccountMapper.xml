<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.zerock.mapper.AccountMapper">

	<insert id="insert">
		INSERT INTO tbl_account (uid, upw, uname, email)
		VALUES (#{uid}, #{upw}, #{uname}, #{email});
	</insert>

	<insert id="insertRoles">
		INSERT INTO tbl_account_roles (uid, rolename)
		VALUES
		<foreach collection="roleNames" item="role" separator=",">
			(#{uid}, #{role})
		</foreach>
	</insert>

	<resultMap type="AccountDTO" id="selectMap">
		<id property="uid" column="uid" />
		<result property="upw" column="upw" />
		<result property="uname" column="uname" />
		<result property="email" column="email" />

		<collection property="roleNames" ofType="AccountRole">

			<result column="rolename"
				typeHandler="org.apache.ibatis.type.EnumTypeHandler"
				javaType="AccountRole" />
		</collection>
	</resultMap>

	<select id="selectOne" resultMap="selectMap">
		SELECT
		ac.uid, ac.upw, ac.uname,
		ac.email, ar.rolename
		FROM
		tbl_account AS ac INNER JOIN
		tbl_account_roles AS ar
		ON ac.uid = ar.uid
		WHERE ac.uid = #{uid};
	</select>

</mapper>
